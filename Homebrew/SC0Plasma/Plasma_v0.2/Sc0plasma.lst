Sjasm Z80 Assembler v0.42c - www.xl2s.tk             [2023.03.08 - 01:34:44]

Sc0plasma.asm
Errors: 0

       1   00:0000                      ; Sc0Plasma v0.2
       2   00:0000                      ; Plasma Effect with ASCII in TXT Mode 0
       3   00:0000                      ; Ported to the NaBu-PC by Lars The 18Th
       4   00:0000                      ;
       5   00:0000                      ; Original idea and code example by
       6   00:0000                      ; nick: goblinish (Krapivin Dmitry)
       7   00:0000                      
       8   00:0000                      
       9   00:0000                      	output 000001.nabu
      10   00:0000                      
      11   00:0000                      	defpage 0,#140d
      12   00:0000  (00)                	page 0
      13   00:140D                      
      14   00:140D                      	code
      15   00:140D                      	
      16   00:140D  (00:7F00)           sinpl	equ #7F00			; Sinus Destination in RAM
      17   00:140D  (00:8000)           charpl	equ sinpl+256		; Plasma Destination in RAM
      18   00:140D  (00:00A0)           vdpram	equ #A0				; VDP RAM
      19   00:140D  (00:00A1)           vdpio	equ #A1				; VDP IO
      20   00:140D                      
      21   00:140D                      
      22   00:140D  00                  					nop
      23   00:140E  00                  					nop
      24   00:140F  00                  					nop
      25   00:1410  F3                  					di
      26   00:1411                      
      27   00:1411                      ; Set color 15,1
      28   00:1411  3E F1               					ld a,#f1							; TXT color 15, Back color 1
      29   00:1413  D3 A1               					out (vdpio),a
      30   00:1415                      					
      31   00:1415  3E 87               					ld a,#87
      32   00:1417  D3 A1               					out (vdpio),a
      33   00:1419                      
      34   00:1419                      
      35   00:1419                      ; Put all 5 Chars in VRAM
      36   00:1419                      
      37   00:1419  06 05               					ld b,5
      38   00:141B  0E A1               					ld c,vdpio
      39   00:141D  21 D8 14            					ld hl,charset
      40   00:1420                      add_chars:
      41   00:1420  C5                  					push bc
      42   00:1421  ED A3               					outi								; Set adress Low byte
      43   00:1423  ED A3               					outi								; Set adress High byte
      44   00:1425                      
      45   00:1425  06 08               						ld b,8
      46   00:1427  0E A0               						ld c,vdpram
      47   00:1429                      setvdpregisters:
      48   00:1429  ED A3               						outi
      49   00:142B  C2 29 14            						jp nz,setvdpregisters			; Write to VRAM
      50   00:142E                      
      51   00:142E  C1                  					pop bc
      52   00:142F  10 EF               					djnz add_chars
      53   00:1431                      
      54   00:1431                      					
      55   00:1431                      ;copy chars to RAM
      56   00:1431  11 00 80            					ld de,charpl
      57   00:1434                      copch1:
      58   00:1434  21 C5 14            					ld hl,plchar
      59   00:1437                      copch2:
      60   00:1437  7E                  					ld a,(hl)
      61   00:1438  23                  					inc hl
      62   00:1439  B7                  					or a
      63   00:143A  28 F8               					jr z,copch1
      64   00:143C  12                  					ld (de),a
      65   00:143D  1C                  					inc e
      66   00:143E  20 F7               					jr nz,copch2
      67   00:1440                      
      68   00:1440                      
      69   00:1440                      ;generate sinus
      70   00:1440  01 00 7F            					ld bc,sinpl
      71   00:1443  61                  					ld h,c
      72   00:1444  69                  					ld l,c
      73   00:1445  59                  					ld e,c
      74   00:1446  51                  					ld d,c
      75   00:1447                      genlp:
      76   00:1447  19                  					add hl,de
      77   00:1448  7C                  					ld a,h
      78   00:1449  02                  					ld (bc),a
      79   00:144A  C5                  					push bc
      80   00:144B                      
      81   00:144B  78                  					ld a,b
      82   00:144C  91                  					sub c
      83   00:144D  4F                  					ld c,a
      84   00:144E                      
      85   00:144E  78                  					ld a,b
      86   00:144F  94                  					sub h
      87   00:1450  02                  					ld (bc),a
      88   00:1451  C1                  					pop bc
      89   00:1452                      
      90   00:1452  7B                  					ld a,e
      91   00:1453  C6 08               					add a,8
      92   00:1455  5F                  					ld e,a
      93   00:1456  30 01               					jr nc,noincd
      94   00:1458  14                  					inc d
      95   00:1459                      noincd:
      96   00:1459  0C                  					inc c
      97   00:145A  CB 71               					bit 6,c
      98   00:145C  28 E9               					jr z,genlp
      99   00:145E                      
     100   00:145E  50                  					ld d,b
     101   00:145F  1E 80               					ld e,#80
     102   00:1461  48                  					ld c,b
     103   00:1462                      neglp:
     104   00:1462  0A                  					ld a,(bc)
     105   00:1463  CB 2F               					sra a
     106   00:1465  02                  					ld (bc),a
     107   00:1466  12                  					ld (de),a
     108   00:1467  1C                  					inc e
     109   00:1468  0D                  					dec c
     110   00:1469  20 F7               					jr nz,neglp
     111   00:146B                      
     112   00:146B                      ;draw plasma
     113   00:146B                      plas_lp:
     114   00:146B                      					;keep params
     115   00:146B  D5                  					push de
     116   00:146C  C5                  					push bc
     117   00:146D  D9                  					exx
     118   00:146E  21 D8 14            					ld hl,pltxt
     119   00:1471  E5                  					push hl
     120   00:1472  D9                  					exx
     121   00:1473                      
     122   00:1473  DD                  					db #DD						; #DD, 2E -> Undocumented instruction !
     123   00:1474  2E 18               					ld l,24						; ld ixl,n
     124   00:1476                      
     125   00:1476                      ply:
     126   00:1476  3E 28               					ld a,40
     127   00:1478                      
     128   00:1478  D5                  					push de
     129   00:1479                      
     130   00:1479                      plx:
     131   00:1479  08                  					ex af,af'
     132   00:147A  26 7F               					ld h,sinpl/256
     133   00:147C  6B                  					ld l,e
     134   00:147D  7E                  					ld a,(hl)
     135   00:147E  6A                  					ld l,d
     136   00:147F  86                  					add a,(hl)
     137   00:1480  69                  					ld l,c
     138   00:1481  86                  					add a,(hl)
     139   00:1482  68                  					ld l,b
     140   00:1483  86                  					add a,(hl)
     141   00:1484                      
     142   00:1484  6F                  					ld l,a
     143   00:1485  24                  					inc h
     144   00:1486  7E                  					ld a,(hl)
     145   00:1487                      
     146   00:1487  D9                  					exx
     147   00:1488  77                  					ld (hl),a
     148   00:1489  23                  					inc hl
     149   00:148A  D9                  					exx
     150   00:148B                      
     151   00:148B  14                  					inc d	
     152   00:148C  1C                  					inc e
     153   00:148D  1C                  					inc e
     154   00:148E  1C                  					inc e
     155   00:148F                      
     156   00:148F  08                  					ex af,af'
     157   00:1490  3D                  					dec a
     158   00:1491  C2 79 14            					jp nz,plx
     159   00:1494                      
     160   00:1494  D1                  					pop de
     161   00:1495                      
     162   00:1495  1C                  					inc e
     163   00:1496  1C                  					inc e
     164   00:1497  15                  					dec d
     165   00:1498  15                  					dec d
     166   00:1499  15                  					dec d
     167   00:149A                      
     168   00:149A  78                  					ld a,b
     169   00:149B  C6 01               					add a,1
     170   00:149D  47                  					ld b,a
     171   00:149E                      
     172   00:149E  79                  					ld a,c
     173   00:149F  C6 03               					add a,3
     174   00:14A1  4F                  					ld c,a
     175   00:14A2                      
     176   00:14A2  DD                  					db #dd						; #DD,#2D -> Undocumented instruction !
     177   00:14A3  2D                  					dec l						; dec ixl 
     178   00:14A4  C2 76 14            					jp nz,ply
     179   00:14A7                      
     180   00:14A7                      ;copy to screen
     181   00:14A7  E1                  					pop hl ; ld hl,pltxt
     182   00:14A8  AF                  					xor a
     183   00:14A9  D3 A1               					out (vdpio),a
     184   00:14AB                      					
     185   00:14AB  F6 48               					or #48
     186   00:14AD  D3 A1               					out (vdpio),a
     187   00:14AF  3E 04               					ld a,4
     188   00:14B1                      olp:
     189   00:14B1  01 A0 00            					ld bc,#a0
     190   00:14B4  ED B3               					otir
     191   00:14B6  3D                  					dec a
     192   00:14B7  20 F8               					jr nz,olp
     193   00:14B9                      
     194   00:14B9  C1                  					pop bc
     195   00:14BA  0C                  					inc c
     196   00:14BB  04                  					inc b
     197   00:14BC  04                  					inc b
     198   00:14BD  D1                  					pop de
     199   00:14BE                      
     200   00:14BE  1C                  					inc e
     201   00:14BF  14                  					inc d
     202   00:14C0  14                  					inc d
     203   00:14C1                      
     204   00:14C1  C3 6B 14            					jp plas_lp
     205   00:14C4                      
     206   00:14C4  C9                  					ret
     207   00:14C5                      
     208   00:14C5                      plchar:
     209   00:14C5                      	db "..oo**OO00OO**oo.." ; .o*O0O*o.
     209   00:14C5  2E 2E 6F 6F 2A 2A 4F 4F 30 30 4F 4F 2A 2A 6F 6F 
     209   00:14D5  2E 2E 
     210   00:14D7  00                  	db 0
     211   00:14D8                      pltxt:
     212   00:14D8                      
     213   00:14D8                      charset:
     214   00:14D8                      char_star:
     215   00:14D8                      ; Recreate the '*' charakter
     216   00:14D8  50 41               					db #50,#01+64						;VRAM adress 0150
     217   00:14DA  20                  					db %00100000
     218   00:14DB  A8                  					db %10101000
     219   00:14DC  70                  					db %01110000
     220   00:14DD  20                  					db %00100000
     221   00:14DE  70                  					db %01110000
     222   00:14DF  A8                  					db %10101000
     223   00:14E0  20                  					db %00100000
     224   00:14E1  00                  					db %00000000
     225   00:14E2                      
     226   00:14E2                      char_dot
     227   00:14E2                      ; Recreate the '.' charakter
     228   00:14E2  70 41               					db #70,#01+64						;VRAM adress 0170
     229   00:14E4  00                  					db %00000000
     230   00:14E5  00                  					db %00000000
     231   00:14E6  00                  					db %00000000
     232   00:14E7  00                  					db %00000000
     233   00:14E8  00                  					db %00000000
     234   00:14E9  60                  					db %01100000
     235   00:14EA  60                  					db %01100000
     236   00:14EB  00                  					db %00000000
     237   00:14EC                      
     238   00:14EC                      char_zero:
     239   00:14EC                      ; Recreate the 'O' charakter
     240   00:14EC  80 41               					db #80,#01+64						;VRAM adress 0180
     241   00:14EE  70                  					db %01110000
     242   00:14EF  88                  					db %10001000
     243   00:14F0  98                  					db %10011000
     244   00:14F1  A8                  					db %10101000
     245   00:14F2  C8                  					db %11001000
     246   00:14F3  88                  					db %10001000
     247   00:14F4  70                  					db %01110000
     248   00:14F5  00                  					db %00000000
     249   00:14F6                      					
     250   00:14F6                      char_o_up:
     251   00:14F6                      ; Recreate the 'O' charakter
     252   00:14F6  78 42               					db #78,#02+64						;VRAM adress 0278
     253   00:14F8  70                  					db %01110000
     254   00:14F9  88                  					db %10001000
     255   00:14FA  88                  					db %10001000
     256   00:14FB  88                  					db %10001000
     257   00:14FC  88                  					db %10001000
     258   00:14FD  88                  					db %10001000
     259   00:14FE  70                  					db %01110000
     260   00:14FF  00                  					db %00000000
     261   00:1500                      					
     262   00:1500                      char_o_low:
     263   00:1500                      ; Recreate the 'o' charakter
     264   00:1500  78 43               					db #78,#03+64						;VRAM adress 0378
     265   00:1502  00                  					db %00000000
     266   00:1503  00                  					db %00000000
     267   00:1504  70                  					db %01110000
     268   00:1505  88                  					db %10001000
     269   00:1506  88                  					db %10001000
     270   00:1507  88                  					db %10001000
     271   00:1508  70                  					db %01110000
     272   00:1509  00                  					db %00000000
     273   00:150A                      
     274   00:150A                      
     275   00:150A                      
     276   00:150A                      
     277   00:150A                      
     278   00:150A                      
     279   00:150A                      
     280   00:150A                      
     281   00:150A                      
     282   00:150A                      
     283   00:150A                      

    LABELS
-------------------------------------------------
00:00007F00   sinpl
00:00008000   charpl
00:000000A0   vdpram
00:000000A1   vdpio
00:00001420   add_chars
00:00001429   setvdpregisters
00:00001434   copch1
00:00001437   copch2
00:00001447   genlp
00:00001459   noincd
00:00001462   neglp
00:0000146B   plas_lp
00:00001476   ply
00:00001479   plx
00:000014B1   olp
00:000014C5   plchar
00:000014D8   pltxt
00:000014D8   charset
00:000014D8 X char_star
00:000014E2 X char_dot
00:000014EC X char_zero
00:000014F6 X char_o_up
00:00001500 X char_o_low


 Output: Sc0plasma.out
-------------------------------------------------

 Page: 00
  Org: 00000000  Size: *  Used: 00000000

    No output

 Output: 000001.nabu
-------------------------------------------------

 Page: 00
  Org: 0000140D  Size: *  Used: 000000FD

   Address   Length Align   Label
   0000140D     253         add_chars
